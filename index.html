<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>所得割 精密抽出</title>
<script src="https://cdn.jsdelivr.net/npm/tesseract.js@2/dist/tesseract.min.js"></script>
</head>
<body>

<h2>市民税＋県民税 所得割合算（強化版）</h2>

<input type="file" id="imageInput">
<br><br>
<button onclick="runOCR()">読み取り</button>

<p id="result"></p>

<script>
function runOCR() {

  const file = document.getElementById('imageInput').files[0];
  if (!file) return;

  Tesseract.recognize(file, 'jpn')
  .then(({ data: { text } }) => {

    // 改行・空白を除去
    const cleanText = text.replace(/\s+/g, "");

    // 市民税 所得割 抽出
    const cityMatch = cleanText.match(
      /(市民税|区民税|町民税).*?所得割.*?([0-9,]+)/
    );

    // 県民税 所得割 抽出
    const prefMatch = cleanText.match(
      /(県民税|都民税|道民税|府民税).*?所得割.*?([0-9,]+)/
    );

    const cityTax = cityMatch
      ? Number(cityMatch[2].replace(/,/g,""))
      : 0;

    const prefTax = prefMatch
      ? Number(prefMatch[2].replace(/,/g,""))
      : 0;

    const total = cityTax + prefTax;

    document.getElementById("result").innerHTML =
      "市民税所得割: " + cityTax.toLocaleString() + " 円<br>" +
      "県民税所得割: " + prefTax.toLocaleString() + " 円<br><br>" +
      "<strong>合計: " + total.toLocaleString() + " 円</strong>";

  });
}
</script>

</body>
</html>
